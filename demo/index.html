<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>GeoCENS JS API Test Example</title>
  <style>
    body {
      width: 50%;
      margin: 0 auto;
      padding-bottom: 5em;
    }

    .code {
      border: 1px solid #555;
      background-color: #FFE;
      display: block;
      max-width: 80%;
    }
  </style>
</head>
<body>
<h1>GeoCENS JS API Interactive Tutorial</h1>

<p>The GeoCENS JavaScript API allows developers to retrieve data from the GeoCENS Data Service. Here are a few interactive examples.</p>

<p>Note: This tutorial may stop working if the API key is revoked or the data is moved.</p>

<h2>Include the Libraries</h2>

<p>The JS API requires jQuery 1.10.1 or newer. Be sure to include it before including the GeoCENS JS API.</p>

<pre class="code">

  &lt;script src="jquery.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;
  &lt;script src="geocens.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;

</pre>

<script src="../test/vendor/jquery.js" type="text/javascript" charset="utf-8"></script>
<script src="../geocens.js" type="text/javascript" charset="utf-8"></script>


<h2>Create a Service Object</h2>

<p>A service object allows you to retrieve specific sensors from the GeoCENS Data Service. You will need an account with the GeoCENS Data Service to generate an API token key; this key allows you to retrieve data from the Restful API. A registration page for the Data Service is coming soon.</p>

<p>Creating a service object is simple:</p>

<pre class="code">

  var api_key = "57378dc18d74bef1051312e29a26f0b3";

  var service = new Geocens.DataService({
    api_key: api_key
  });

</pre>
<button id="example_one">Run Example</button>
<script>
  $(document).ready(function() {
    $("#example_one").on("click", function() {
      var api_key = "57378dc18d74bef1051312e29a26f0b3";

      var service = new Geocens.DataService({
        api_key: api_key
      });

      console.log("Example One", service);

      alert("service: " + service.path + "\n"
        + "key: " + service.api_key);
    });
  }());
</script>

<h2>Retrieve a Datastream</h2>

<p>With a Datastream object, we can now retrieve a datastream. There are two identifiers for each datastream: the sensor ID, and the datastream ID. (These are part of the GeoCENS Data Service specification.) Using these identifiers we can get the datastream.</p>

<p>Once we have the datastream, we can get the datastream attributes using the <code>attributes()</code> method.</p>

<pre class="code">

  var api_key = "57378dc18d74bef1051312e29a26f0b3";

  var service = new Geocens.DataService({
    api_key: api_key
  });

  service.getDatastream({
    sensor_id: "4ddecd5124661f9442cfca8be23f8dda",
    datastream_id: "ccc92c6fe57dff592ff687d99c4ebf70",
    done: function(datastream) {
      console.log("Example Two", datastream);
      alert(JSON.stringify(datastream.attributes()));
    }
  });

</pre>
<button id="example_two">Run Example</button>
<script>
  $(document).ready(function() {
    $("#example_two").on("click", function() {
      var api_key = "57378dc18d74bef1051312e29a26f0b3";

      var service = new Geocens.DataService({
        api_key: api_key
      });

      service.getDatastream({
        sensor_id: "4ddecd5124661f9442cfca8be23f8dda",
        datastream_id: "ccc92c6fe57dff592ff687d99c4ebf70",
        done: function(datastream) {
          console.log("Example Two", datastream);
          alert(JSON.stringify(datastream.attributes()));
        }
      });
    });
  }());
</script>

<h2>Retrieve a Datastream Time Series</h2>

<p>The main use case of the JS API is retrieving observations from sensors, and this can be done using the <code>getTimeSeries()</code> method.</p>

<pre class="code">

  var api_key = "57378dc18d74bef1051312e29a26f0b3";

  var goGetObservations = function(datastream) {
    datastream.getTimeSeries({
      done: function(seriesData) {
        console.log("Example Three", seriesData);
        alert(JSON.stringify(seriesData));
      }
    });
  };

  var service = new Geocens.DataService({
    api_key: api_key
  });

  service.getDatastream({
    sensor_id: "4ddecd5124661f9442cfca8be23f8dda",
    datastream_id: "ccc92c6fe57dff592ff687d99c4ebf70",
    done: goGetObservations
  });

</pre>
<button id="example_three">Run Example</button>
<script>
  $(document).ready(function() {
    $("#example_three").on("click", function() {

      var api_key = "57378dc18d74bef1051312e29a26f0b3";

      var goGetObservations = function(datastream) {
        datastream.getTimeSeries({
          done: function(seriesData) {
            console.log("Example Three", seriesData);
            alert(JSON.stringify(seriesData));
          }
        });
      };

      var service = new Geocens.DataService({
        api_key: api_key
      });

      service.getDatastream({
        sensor_id: "4ddecd5124661f9442cfca8be23f8dda",
        datastream_id: "ccc92c6fe57dff592ff687d99c4ebf70",
        done: goGetObservations
      });

    });
  }());
</script>

<h2>Create an OGC SOS Service Object</h2>

<p>OGC SOS Service Objects allow you to retrieve observation data.</p>

<p>Creating an OGC SOS service object is simple:</p>

<pre class="code">

  var service = new Geocens.SOS({
    service_url: "http://app.geocens.ca:8171/sos"
  });

</pre>
<button id="example_four">Run Example</button>
<script>
  $(document).ready(function() {
    $("#example_four").on("click", function() {
      var service = new Geocens.SOS({
        service_url: "http://app.geocens.ca:8171/sos"
      });

      console.log("Example Four", service);

      alert("service: " + service.path);
    });
  }());
</script>

<h2>Retrieve SOS Observations</h2>

<p>Once we have a service object for the SOS, we can retrieve the SOS Observations for an Offering and Observed Property.</p>

<pre class="code">

  var service = new Geocens.SOS({
    service_url: "http://app.geocens.ca:8171/sos"
  });

  service.getObservation({
    offering: "Temperature",
    property: "urn:ogc:def:property:noaa:ndbc:Water Temperature",
    done: function (observations) {
      console.log("Example Five", observations);
      alert(JSON.stringify(observations[0].attributes()));
    }
  });

</pre>
<button id="example_five">Run Example</button>
<script>
  $(document).ready(function() {
    $("#example_five").on("click", function() {
      var service = new Geocens.SOS({
        service_url: "http://app.geocens.ca:8171/sos"
      });

      service.getObservation({
        offering: "Temperature",
        property: "urn:ogc:def:property:noaa:ndbc:Water Temperature",
        done: function (observations) {
          console.log("Example Five", observations);
          alert(JSON.stringify(observations[0].attributes()));
        }
      });
    });
  }());
</script>

<h2>Retrieve an Observation Time Series</h2>

<p>Each Observation object has a method for retrieving the series records.</p>

<pre class="code">

  var goGetRecords = function(observations) {
    observations[0].getTimeSeries({
      done: function(seriesData) {
        console.log("Example Six", seriesData);
        alert(JSON.stringify(seriesData));
      }
    });
  };

  var service = new Geocens.SOS({
    service_url: "http://app.geocens.ca:8171/sos"
  });

  service.getObservation({
    offering: "Temperature",
    observed_property: "urn:ogc:def:property:noaa:ndbc:Water Temperature",
    done: goGetRecords
  });

</pre>
<button id="example_six">Run Example</button>
<script>
  $(document).ready(function() {
    $("#example_six").on("click", function() {

      var goGetRecords = function(observations) {
        observations[0].getTimeSeries({
          done: function(seriesData) {
            console.log("Example Six", seriesData);
            alert(JSON.stringify(seriesData));
          }
        });
      };

      var service = new Geocens.SOS({
        service_url: "http://app.geocens.ca:8171/sos"
      });

      service.getObservation({
        offering: "Temperature",
        observed_property: "urn:ogc:def:property:noaa:ndbc:Water Temperature",
        done: goGetRecords
      });

    });
  }());
</script>

<h2>Retrieve an Observation Sensor Description</h2>

<p>Each Observation object has a method for retrieving the sensorML document for its procedure.</p>

<pre class="code">

  var goGetDescription = function(observations) {
    observations[0].describe({
      done: function(sensorML) {
        console.log("Example Seven", sensorML);
        alert(JSON.stringify(sensorML));
      }
    });
  };

  var service = new Geocens.SOS({
    service_url: "http://app.geocens.ca:8171/sos"
  });

  service.getObservation({
    offering: "Temperature",
    observed_property: "urn:ogc:def:property:noaa:ndbc:Water Temperature",
    done: goGetDescription
  });

</pre>
<button id="example_seven">Run Example</button>
<script>
  $(document).ready(function() {
    $("#example_seven").on("click", function() {

      var goGetDescription = function(observations) {
        observations[0].describe({
          done: function(sensorML) {
            console.log("Example Seven", sensorML);
            alert(JSON.stringify(sensorML));
          }
        });
      };

      var service = new Geocens.SOS({
        service_url: "http://app.geocens.ca:8171/sos"
      });

      service.getObservation({
        offering: "Temperature",
        observed_property: "urn:ogc:def:property:noaa:ndbc:Water Temperature",
        done: goGetDescription
      });

    });
  }());
</script>

</body>
</html>
