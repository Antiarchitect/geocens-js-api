<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>GeoCENS JS API Test Example</title>
  <style>
    body {
      width: 50%;
      margin: 0 auto;
      padding-bottom: 5em;
    }

    .code {
      border: 1px solid #555;
      background-color: #FFE;
      display: block;
      max-width: 80em;
    }
  </style>
</head>
<body>
<h1>GeoCENS JS API Interactive Tutorial</h1>

<p>The GeoCENS JavaScript API allows developers to retrieve data from the GeoCENS Data Service. Here are a few interactive examples.</p>

<p>Note: Parts of this tutorial may stop working if the API key is revoked or the data is moved.</p>

<h2>Table of Contents</h2>

<ol>
  <li><a href="#include">Include the Libraries</a></li>
  <li><a href="#data_service_object">Create a Service Object</a></li>
  <li><a href="#get_datastream">Retrieve a Datastream</a></li>
  <li><a href="#datastream_time_series">Retrieve a Datastream Time Series</a></li>
  <li><a href="#ogc_sos_object">Create an OGC SOS Service Object</a></li>
  <li><a href="#get_observation">Retrieve SOS Observations</a></li>
  <li><a href="#get_observation_time_series">Retrieve an Observation Time Series</a></li>
  <li><a href="#get_observation_description">Retrieve an Observation Sensor Description</a></li>
  <li><a href="#chart_include">Including the Chart Module</a></li>
  <li><a href="#chart_datastream_series">Datastream Time Series Chart</a></li>
  <li><a href="#chart_observation_series">Observation Time Series Chart</a></li>
</ol>

<h2 id="include">Include the Libraries</h2>

<p>The JS API requires <a href="http://jquery.com/">jQuery</a> (1.10.1 or newer). Be sure to include it before including the GeoCENS JS API.</p>

<pre class="code">

  &lt;script src="jquery.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;
  &lt;script src="geocens.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;

</pre>

<script src="../test/vendor/jquery.js" type="text/javascript" charset="utf-8"></script>
<script src="../geocens.js" type="text/javascript" charset="utf-8"></script>


<h2 id="data_service_object">Create a Service Object</h2>

<p>A service object allows you to retrieve specific sensors from the GeoCENS Data Service. You will need an account with the GeoCENS Data Service to generate an API token key; this key allows you to retrieve data from the Restful API. A registration page for the Data Service is coming soon.</p>

<p>Creating a service object is simple:</p>

<pre class="code">

  var api_key = &quot;57378dc18d74bef1051312e29a26f0b3&quot;;

  var service = new Geocens.DataService({
    api_key: api_key
  });

</pre>
<button id="example_one">Run Example</button>
<script>
  $(document).ready(function() {
    $("#example_one").on("click", function() {
      var api_key = "57378dc18d74bef1051312e29a26f0b3";

      var service = new Geocens.DataService({
        api_key: api_key
      });

      console.log("Example One", service);

      alert("service: " + service.path + "\n"
        + "key: " + service.api_key);
    });
  }());
</script>


<h2 id="get_datastream">Retrieve a Datastream</h2>

<p>With a Datastream object, we can now retrieve a datastream. There are two identifiers for each datastream: the sensor ID, and the datastream ID. (These are part of the GeoCENS Data Service specification.) Using these identifiers we can get the datastream.</p>

<p>Once we have the datastream, we can get the datastream attributes using the <code>attributes()</code> method.</p>

<pre class="code">

  var api_key = &quot;57378dc18d74bef1051312e29a26f0b3&quot;;

  var service = new Geocens.DataService({
    api_key: api_key
  });

  service.getDatastream({
    sensor_id: &quot;4ddecd5124661f9442cfca8be23f8dda&quot;,
    datastream_id: &quot;ccc92c6fe57dff592ff687d99c4ebf70&quot;,
    done: function(datastream) {
      console.log(&quot;Example Two&quot;, datastream);
      alert(JSON.stringify(datastream.attributes()));
    }
  });

</pre>
<button id="example_two">Run Example</button>
<script>
  $(document).ready(function() {
    $("#example_two").on("click", function() {
      var api_key = "57378dc18d74bef1051312e29a26f0b3";

      var service = new Geocens.DataService({
        api_key: api_key
      });

      service.getDatastream({
        sensor_id: "4ddecd5124661f9442cfca8be23f8dda",
        datastream_id: "ccc92c6fe57dff592ff687d99c4ebf70",
        done: function(datastream) {
          console.log("Example Two", datastream);
          alert(JSON.stringify(datastream.attributes()));
        }
      });
    });
  }());
</script>


<h2 id="datastream_time_series">Retrieve a Datastream Time Series</h2>

<p>The main use case of the JS API is retrieving observations from sensors, and this can be done using the <code>getTimeSeries()</code> method.</p>

<pre class="code">

  var api_key = &quot;57378dc18d74bef1051312e29a26f0b3&quot;;

  var goGetObservations = function(datastream) {
    datastream.getTimeSeries({
      start: new Date(&quot;2012-01-01T00:00:00Z&quot;),
      end:   new Date(&quot;2013-01-01T00:00:00Z&quot;),
      done:  function(seriesData) {
        console.log(&quot;Example Three&quot;, seriesData);
        alert(JSON.stringify(seriesData));
      }
    });
  };

  var service = new Geocens.DataService({
    api_key: api_key
  });

  service.getDatastream({
    sensor_id: &quot;4ddecd5124661f9442cfca8be23f8dda&quot;,
    datastream_id: &quot;ccc92c6fe57dff592ff687d99c4ebf70&quot;,
    done: goGetObservations
  });

</pre>
<button id="example_three">Run Example</button>
<script>
  $(document).ready(function() {
    $("#example_three").on("click", function() {

      var api_key = "57378dc18d74bef1051312e29a26f0b3";

      var goGetObservations = function(datastream) {
        datastream.getTimeSeries({
          start: new Date("2012-01-01T00:00:00Z"),
          end:   new Date("2013-01-01T00:00:00Z"),
          done:  function(seriesData) {
            console.log("Example Three", seriesData);
            alert(JSON.stringify(seriesData));
          }
        });
      };

      var service = new Geocens.DataService({
        api_key: api_key
      });

      service.getDatastream({
        sensor_id: "4ddecd5124661f9442cfca8be23f8dda",
        datastream_id: "ccc92c6fe57dff592ff687d99c4ebf70",
        done: goGetObservations
      });

    });
  }());
</script>


<h2 id="ogc_sos_object">Create an OGC SOS Service Object</h2>

<p>OGC SOS Service Objects allow you to retrieve observation data.</p>

<p>Creating an OGC SOS service object is simple:</p>

<pre class="code">

  var service = new Geocens.SOS({
    service_url: &quot;http://app.geocens.ca:8171/sos&quot;
  });

</pre>
<button id="example_four">Run Example</button>
<script>
  $(document).ready(function() {
    $("#example_four").on("click", function() {
      var service = new Geocens.SOS({
        service_url: "http://app.geocens.ca:8171/sos"
      });

      console.log("Example Four", service);

      alert("service: " + service.path);
    });
  }());
</script>


<h2 id="get_observation">Retrieve SOS Observations</h2>

<p>Once we have a service object for the SOS, we can retrieve the SOS Observations for an Offering and Observed Property.</p>

<pre class="code">

  var service = new Geocens.SOS({
    service_url: &quot;http://app.geocens.ca:8171/sos&quot;
  });

  service.getObservation({
    offering: &quot;Temperature&quot;,
    property: &quot;urn:ogc:def:property:noaa:ndbc:Water Temperature&quot;,
    done: function (observations) {
      console.log(&quot;Example Five&quot;, observations);
      alert(JSON.stringify(observations[0].attributes()));
    }
  });

</pre>
<button id="example_five">Run Example</button>
<script>
  $(document).ready(function() {
    $("#example_five").on("click", function() {
      var service = new Geocens.SOS({
        service_url: "http://app.geocens.ca:8171/sos"
      });

      service.getObservation({
        offering: "Temperature",
        property: "urn:ogc:def:property:noaa:ndbc:Water Temperature",
        done: function (observations) {
          console.log("Example Five", observations);
          alert(JSON.stringify(observations[0].attributes()));
        }
      });
    });
  }());
</script>


<h2 id="get_observation_time_series">Retrieve an Observation Time Series</h2>

<p>Each Observation object has a method for retrieving the series records.</p>

<pre class="code">

  var goGetRecords = function(observations) {
    observations[0].getTimeSeries({
      start: new Date(&quot;2012-01-01T00:00:00Z&quot;),
      end:   new Date(&quot;2012-06-01T00:00:00Z&quot;),
      done:  function(seriesData) {
        console.log(&quot;Example Six&quot;, seriesData);
        alert(JSON.stringify(seriesData));
      }
    });
  };

  var service = new Geocens.SOS({
    service_url: &quot;http://app.geocens.ca:8171/sos&quot;
  });

  service.getObservation({
    offering: &quot;Temperature&quot;,
    property: &quot;urn:ogc:def:property:noaa:ndbc:Water Temperature&quot;,
    done: goGetRecords
  });

</pre>
<button id="example_six">Run Example</button>
<script>
  $(document).ready(function() {
    $("#example_six").on("click", function() {

      var goGetRecords = function(observations) {
        observations[0].getTimeSeries({
          start: new Date("2012-01-01T00:00:00Z"),
          end:   new Date("2012-06-01T00:00:00Z"),
          done:  function(seriesData) {
            console.log("Example Six", seriesData);
            alert(JSON.stringify(seriesData));
          }
        });
      };

      var service = new Geocens.SOS({
        service_url: "http://app.geocens.ca:8171/sos"
      });

      service.getObservation({
        offering: "Temperature",
        property: "urn:ogc:def:property:noaa:ndbc:Water Temperature",
        done: goGetRecords
      });

    });
  }());
</script>


<h2 id="get_observation_description">Retrieve an Observation Sensor Description</h2>

<p>Each Observation object has a method for retrieving the sensorML document for its procedure.</p>

<pre class="code">

  var goGetDescription = function(observations) {
    observations[0].describe({
      done: function(sensorML) {
        console.log(&quot;Example Seven&quot;, sensorML);
        alert(JSON.stringify(sensorML));
      }
    });
  };

  var service = new Geocens.SOS({
    service_url: &quot;http://app.geocens.ca:8171/sos&quot;
  });

  service.getObservation({
    offering: &quot;Temperature&quot;,
    property: &quot;urn:ogc:def:property:noaa:ndbc:Water Temperature&quot;,
    done: goGetDescription
  });

</pre>
<button id="example_seven">Run Example</button>
<script>
  $(document).ready(function() {
    $("#example_seven").on("click", function() {

      var goGetDescription = function(observations) {
        observations[0].describe({
          done: function(sensorML) {
            console.log("Example Seven", sensorML);
            alert(JSON.stringify(sensorML));
          }
        });
      };

      var service = new Geocens.SOS({
        service_url: "http://app.geocens.ca:8171/sos"
      });

      service.getObservation({
        offering: "Temperature",
        property: "urn:ogc:def:property:noaa:ndbc:Water Temperature",
        done: goGetDescription
      });

    });
  }());
</script>


<h2 id="chart_include">Including the Chart Module</h2>

<p>There is an optional module for drawing time series graphs for observations and datastreams. It requires <a href="http://www.highcharts.com/">HighStock</a> (1.3.2 or newer), <a href="http://jquery.com/">jQuery</a> (1.10.1 or newer), and the core GeoCENS JS API (0.4.1 or newer).</p>

<pre class="code">

  &lt;script src="jquery.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;
  &lt;script src="geocens.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;
  &lt;script src="highstock.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;
  &lt;script src="geocens-chart.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;

</pre>
<script src="../test/vendor/highstock.js" type="text/javascript" charset="utf-8"></script>
<script src="../geocens-chart.js" type="text/javascript" charset="utf-8"></script>

<p>Be sure to include HighStock <em>before</em> including the GeoCENS Chart module!</p>

<h2 id="chart_datastream_series">Datastream Time Series Chart</h2>

<p>The GeoCENS Chart module is a jQuery plugin, so it is invoked using a jQuery selector. By passing the data through the callbacks, the datastream time series can be customized before being plotted on the chart.</p>

<pre class="code">

  // Draw the chart after time series is returned
  var drawChart = function(seriesData, datastream) {
    var chart = $(&quot;#chart&quot;).GeocensChart({
      datastream: datastream
    });
  };

  // Retrieve the time series after datastream is returned
  var getSeries = function(datastream) {
    datastream.getTimeSeries({
      start: new Date(&quot;2012-01-01T00:00:00Z&quot;),
      end:   new Date(&quot;2013-01-01T00:00:00Z&quot;),
      done:  drawChart
    });
  };

  // Retrieve the datastream
  Geocens.DataService.getDatastream({
    api_key: &quot;57378dc18d74bef1051312e29a26f0b3&quot;,
    sensor_id: &quot;4ddecd5124661f9442cfca8be23f8dda&quot;,
    datastream_id: &quot;ccc92c6fe57dff592ff687d99c4ebf70&quot;,
    done: getSeries
  });

</pre>

<div id="chart"></div>

<button id="example_eight">Run Example</button>
<script>
  $(document).ready(function() {
    $("#example_eight").on("click", function() {

      // Draw the chart after time series is returned
      var drawChart = function(seriesData, datastream) {
        var chart = $("#chart").GeocensChart({
          datastream: datastream
        });
      };

      // Retrieve the time series after datastream is returned
      var getSeries = function(datastream) {
        datastream.getTimeSeries({
          start: new Date("2012-01-01T00:00:00Z"),
          end:   new Date("2013-01-01T00:00:00Z"),
          done:  drawChart
        });
      };

      // Retrieve the datastream
      Geocens.DataService.getDatastream({
        api_key: "57378dc18d74bef1051312e29a26f0b3",
        sensor_id: "4ddecd5124661f9442cfca8be23f8dda",
        datastream_id: "ccc92c6fe57dff592ff687d99c4ebf70",
        done: getSeries
      });

    });
  }());
</script>


<h2 id="chart_observation_series">Observation Time Series Chart</h2>

<p>Very similarly to the datastream chart, OGC SOS observation data is straight forward.</p>

<pre class="code">

  // Draw the chart after time series is returned
  var drawChart = function(seriesData, observation) {
    var chart = $(&quot;#chart2&quot;).GeocensChart({
      observation: observation
    });
  };

  // Retrieve the time series after observations is returned (note plural)
  var getSeries = function(observations) {
    observations[0].getTimeSeries({
      start: new Date(&quot;2012-01-01T00:00:00Z&quot;),
      end:   new Date(&quot;2012-06-01T00:00:00Z&quot;),
      done:  drawChart
    });
  };

  // Retrieve the observations
  Geocens.SOS.getObservation({
    service_url: &quot;http://app.geocens.ca:8171/sos&quot;,
    offering: &quot;Temperature&quot;,
    property: &quot;urn:ogc:def:property:noaa:ndbc:Water Temperature&quot;,
    done: getSeries
  });

</pre>

<div id="chart2"></div>

<button id="example_nine">Run Example</button>
<script>
  $(document).ready(function() {
    $("#example_nine").on("click", function() {

      // Draw the chart after time series is returned
      var drawChart = function(seriesData, observation) {
        var chart = $("#chart2").GeocensChart({
          observation: observation
        });
      };

      // Retrieve the time series after observations is returned (note plural)
      var getSeries = function(observations) {
        observations[0].getTimeSeries({
          start: new Date("2012-01-01T00:00:00Z"),
          end:   new Date("2012-06-01T00:00:00Z"),
          done:  drawChart
        });
      };

      // Retrieve the observations
      Geocens.SOS.getObservation({
        service_url: "http://app.geocens.ca:8171/sos",
        offering: "Temperature",
        property: "urn:ogc:def:property:noaa:ndbc:Water Temperature",
        done: getSeries
      });

    });
  }());
</script>
</body>
</html>
