<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Geocens-js-api by Canarie-Sensor-RPI</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Geocens-js-api</h1>
          <h2>GeoCENS JavaScript API for Sensor Data Access and Visualization</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/Canarie-Sensor-RPI/geocens-js-api/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/Canarie-Sensor-RPI/geocens-js-api/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/Canarie-Sensor-RPI/geocens-js-api" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a name="geocens-javascript-api" class="anchor" href="#geocens-javascript-api"><span class="octicon octicon-link"></span></a>GeoCENS JavaScript API</h1>

<p>The GeoCENS JavaScript API can be used to retrieve geospatial sensor data from either the GeoCENS Data Service or OGC SOS compatible services, and display the information on a map or chart.</p>

<h2>
<a name="requirements" class="anchor" href="#requirements"><span class="octicon octicon-link"></span></a>Requirements</h2>

<ul>
<li>jQuery 1.10.1 or newer</li>
</ul><h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>For a web page, include the <code>geocens.js</code> file in a script tag:</p>

<pre><code>&lt;script src="javascripts/geocens.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;
</code></pre>

<h3>
<a name="alternate-install-for-rails" class="anchor" href="#alternate-install-for-rails"><span class="octicon octicon-link"></span></a>Alternate Install for Rails</h3>

<p>For use with the Rails asset pipeline, try the <a href="https://github.com/Canarie-Sensor-RPI/geocens-js-api-rails">geocens-js-api-rails</a> gem.</p>

<h2>
<a name="getting-started" class="anchor" href="#getting-started"><span class="octicon octicon-link"></span></a>Getting Started</h2>

<p>Here is a brief introduction on how to retrieve data from the GeoCENS Data Service, with an API Key. If you do not already have a key, please contact us at <a href="mailto:info@geocens.ca">info@geocens.ca</a> or use the JS API to load data from an OGC SOS compatible service. An <a href="http://canarie-sensor-rpi.github.io/geocens-js-api/demo.html">interactive demo is available in the <code>demo</code> directory</a>, and the API Key from there can be used here.</p>

<p>In this example, we will go from an API Key to retrieving a time series for a Datastream. A Datastream is a set of data returned for a single observed property on a sensor.</p>

<p>First, we connect to the Data Service and download a list of sensors:</p>

<pre><code>Geocens.DataService.getSensors({
    api_key: api_key,
    done: function (sensors) {
        window.sensor = sensors[0];
    }
});
</code></pre>

<p>This provides us with a <code>Sensor</code> object in the <code>done</code> callback. We can retrieve properties for the Sensor:</p>

<pre><code>sensor.metadata;
</code></pre>

<p>Which returns an object with the properties:</p>

<pre><code>{
    "id": "5C-86-4A-00-2C-9E",
    "user": "jamesbadger@gmail.com",
    "uid": "4ddecd5124661f9442cfca8be23f8dda",
    "altitude": 1100,
    "samplingrate": 0,
    "loc": [
        51,
        -114
    ],
    "title": "Our first integration Testing",
    "height": 0,
    "nickName": "Alpha",
    "description": "",
    "last_time_online": "2012-09-18T21:04:40",
    "phens": [
        "airtemperature",
        "relatedhumidity",
        "airquality",
        "hydrogentest",
        "hydrogentest1Name"
    ]
}
</code></pre>

<p>We can also use the Sensor object to retrieve the list of datastreams:</p>

<pre><code>sensor.getDatastreams({
    done: function (datastreams) {
            window.datastream = datastreams[0];
    }
});
</code></pre>

<p>With this <code>Datastream</code> object, we can now retrieve the time series data:</p>

<pre><code>datastream.getTimeSeries({
    done: function (seriesData) {
            window.seriesData = seriesData;
    }
});
</code></pre>

<p>By default, <code>getTimeSeries()</code> will retrieve 24 hours of observation values from the Data Service.</p>

<p>The <code>getTimeSeries()</code> method will cache the results in the Datastream object, and return an array of objects:</p>

<pre><code>[{
    timestamp: 1356998400000,
    value: 3.88
},
{
    timestamp: 1369699200000,
    value: 5.22
}]
</code></pre>

<p>The returned objects contain timestamp and value properties. The timestamps correspond to the number of milliseconds since January 1, 1970, 00:00:00 UTC. They can be parsed with JavaScript's built-in Date library: <code>new Date(1356998400000)</code>.</p>

<p>Afterwards, the GeoCENS Map and GeoCENS Chart modules can be used to visualize the sensor and datastreams.</p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>Please see the <a href="https://github.com/Canarie-Sensor-RPI/geocens-js-api/blob/master/API_REFERENCE.markdown">API REFERENCE.markdown</a> document for details about specific functions and usage.</p>

<h2>
<a name="running-test" class="anchor" href="#running-test"><span class="octicon octicon-link"></span></a>Running Test</h2>

<p>There is a test suite for ensuring the JS API meets its requirements. The JS API is build with Behaviour Driven Development (<a href="http://dannorth.net/introducing-bdd/">BDD</a>), which focuses on defining <em>requirements</em> before any code is written. This keeps new code clean and concise, only enough to satisfy the new behaviour.</p>

<p>The tests can be run in a web browser by opening the <code>test/index.html</code> file. They are based on <a href="http://qunitjs.com/">Qunit</a>.</p>

<p>Alternatively, the tests can be run from the command line if Node and NPM is installed.</p>

<pre><code>$ npm install -g grunt-cli
$ npm install
$ grunt qunit
</code></pre>

<p>See <code>Gruntfile.js</code> for more tasks that can be run from the command line.</p>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>2013, James Badger, Geo Sensor Web Lab, All Rights Reserved.</p>
        </section>

        <footer>
          Geocens-js-api is maintained by <a href="https://github.com/Canarie-Sensor-RPI">Canarie-Sensor-RPI</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>